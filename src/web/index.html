<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <link rel="icon" type="image/svg+xml" href="/vite.svg"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Vite + Vue</title>
    <link href=https://unpkg.com/@fortawesome/fontawesome-free@5.13.0/css/all.css rel=stylesheet>
    <link href="https://unpkg.com/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/pev2/dist/style.css" />
</head>
<body>
<div id="app"></div>

<script type="text/javascript">
    function waitForElm(selector, callback) {
        if (document.querySelector(selector)) {
            callback(document.querySelector(selector));
        }

        const observer = new MutationObserver(mutations => {
            if (document.querySelector(selector)) {
                callback(document.querySelector(selector));
            }
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });

        return observer;
    }

    function createRerunBtn() {
        let rerunBtn = document.createElement('button');
        rerunBtn.innerHTML = "<em class='fas fa-sync' style='margin-right: 4px'></em> Re-run";
        rerunBtn.classList.add('btn', 'btn-outline-primary', 'btn-sm');
        rerunBtn.style.position = 'absolute';
        rerunBtn.style.top = '8px';
        rerunBtn.style.left = '8px';

        rerunBtn.addEventListener('click', () => {
            fetch("http://myapp/rerun");
        });

        return rerunBtn;
    }

    (async () => {
        const rerunBtn = createRerunBtn();
        let currContainer = null;

        let observer = waitForElm('.plan', (container) => {
            if(currContainer !== container){
                currContainer = container;
                container.appendChild(rerunBtn);
            }
        });
    })();

</script>

<script type="module" src="/src/main.js"></script>

<script type="text/javascript">
    if (window.QUERY_PLAN && window.setPlan) {
        window.setPlan(window.QUERY_PLAN);
    }
</script>

</body>
</html>
